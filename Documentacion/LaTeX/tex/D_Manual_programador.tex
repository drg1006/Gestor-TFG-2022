\apendice{Documentación técnica de programación}

\section{Introducción}
En esta sección se van a detallarlos diferentes procesos de instalación de las herramientas que se han utilizado durante el proyecto. También se especificará la estructura del proyecto, instalación de dependencias, la compilación, la ejecución del proyecto y el despliegue en Heroku. 
Algunos detalles son similares a los utilizados en el anterior proyecto de \textbf{\textit{Diana,Gestor-TFG-2021}}~\cite{Gestor-TFG-2021}.

\section{Estructura de directorios}
Se enumerarán y describirán brevemente los directorios del proyecto. Se puede encontrar el código fuente en el repositorio de Github denominado \href{https://github.com/drg1006/gestor-tfg-2022}{``Gestor-TFG-2022''}. También se indicarán los nuevos archivos añadidos en esta versión.

\begin{itemize}
	\item \texttt{/:} directorio raíz donde se ubican el README, Maven. 
	\item \texttt{/.github/workflows} los archivos de \textit{workflow} o flujo de trabajo, tanto para la Integración continua del proyecto en GitHub.
	\item \texttt{/Documentacion} material de documentación del proyecto y prueba empleadas.
	\begin{itemize}
		\tightlist
		\item \texttt{/Documentacion/LaTeX} ficheros para generar la memoria y los anexos realizados en \emph{TexStudio}.
		\item \texttt{/Documentacion/Pruebas} aplicaciones prototipo para comenzar el aprendizaje con \href{https://vaadin.com/}{Vaadin} y pruebas realizadas con diferentes librerías durante el webscraping.
	\end{itemize}
	\item \texttt{/frontend} código encargado del diseño gráfico de la aplicación por el lado del cliente.
	\item \texttt{/src}, estructura de directorios \emph{backend} de la aplicación. Ya explicada en la versión anterior del proyecto:
		\begin{itemize}
			\item \texttt{/src/main/java/ubu/digit/persistence} código fuente encargado de la conexión y lectura de los ficheros de datos (fachada de datos).		
			\item \texttt{/src/main/java/ubu/digit/security} código fuente de conexión y consulta con el moodle de UbuVirtual.
			\item \texttt{/src/main/java/ubu/digit/ui} código en relación a las ventanas y vistas de la aplicación.
			\begin{itemize}
				\item \texttt{/src/main/java/ubu/digit/ui/entity} código con las entidades de los proyectos, cursos y usuarios de la aplicación.
					\begin{itemize}
						\item \texttt{PendingProject.java}, nueva entidad de proyecto con estado \emph{Pendiente}.
						\item \texttt{FormularioTFG.java}, nueva entidad con los campos del formulario del TFG.
					\end{itemize}
				\item \texttt{/src/main/java/ubu/digit/ui/components} código con la interfaz gráfica de la barra de navegación y la de pie de página.
				\item \texttt{/src/main/java/ubu/digit/ui/views} código con las vistas de la aplicación.
					\begin{itemize}
						\item \texttt{ProfesoresView.java}, nueva vista con la información histórica de los profesores.
						\item \texttt{ReportView.java}, nueva vista con el código para la realización de reportes.
						\item \texttt{newProjectView.java}, nueva vista con el código que permite subir propuestas de TFGs al servidor.
						\item \texttt{AceptView.java}, nueva vista con el código que permite aceptar o denegar las propuesta de TFGs con estado \emph{Pendiente}.
					\end{itemize}
				\item \texttt{/src/main/java/ubu/digit/util} incluye los métodos empleados de utilidad empleados en toda la app. 
				\item \texttt{/src/main/java/ubu/digit/webService} servicios web empleados para la consulta en moodle.
			\end{itemize}
			
			\item \texttt{/src/test} tests unitarios sobre las clases fachada “SistInfDataCsv” y “SistInfDataXls”.
			
			\item \texttt{/src/main/resources} carpeta con los datos que se van a cargar en el servidor para obtener toda la información necesaria.
		\end{itemize}
	
\end{itemize}
			
\section{Manual del programador}

A continuación se detallará el proceso de instalación de los programas
necesarios para el desarrollo de la aplicación.

\subsection{Instalación de Java}

Actualmente se sigue ejecutando con la versión de Java 11.

Para ello se debe descargar la \href{https://www.oracle.com/es/java/technologies/javase/jdk11-archive-downloads.html}{página de descargas de Oracle Java SE 11.0} y descargar la versión de JDK 11, correspondiente con el sistema operativo que se posea y su arquitectura, ya sea de 64 o 32 bits. Ver imagen \ref{fig:Descarga_JDK_11}.

Tras escoger la versión según el SO, se leerán y aceptarán las licencias de uso de Oracle \ref{fig:Descarga_JDK11_Licencia}, y se hará \emph{click} en descargar.

\imagenflotante{Descarga_JDK_11}{Descarga de JDK 11}{0.9}

También se deberá cambiar la variable de entorno de Java del sistema.

\imagenflotante{Descarga_JDK11_Licencia}{Descarga JDK 11 Licencia}{0.9}


\subsection{Instalación de Eclipse}
A continuación se instalará un entorno de desarrollo integrado(IDE) para Java, en este caso se ha utilizado \textbf{Eclipse IDE for Enterprise Java Developers} en la versión 2021-12. 

Para descargar el IDE se accederá a la \href{https://www.eclipse.org/downloads/packages/release/2021-12/r}{página de descargas de Eclipse} y descargar la opción correspondiente a nuestro sistema operativo del \textbf{Eclipse Installer 2021-12 R}. 

En el caso de los sistemas operativos Windows se descargará un archivo ejecutable que se deberá ejecutar como administrador. Una vez ejecutado se deberá seleccionar la opción ``\textbf{\textit{Eclipse IDE for Enterprise Java Developers}}'' \ref{fig:Eclipse_Installer}. 

\imagenflotante{Eclipse_Installer}{Seleccionar Eclipse}{0.9}

Por último seleccionaremos el JDK (11) que vayamos a utilizar y la carpeta donde queremos instalar nuestro IDE.

\subsection{Instalación del \textit{plugin de Vaadin} para Eclipse}
Una vez se haya instalado Eclipse, se procederá a añadir el plugin de Vaadin para Eclipse. Esto se realizará mediante el \textbf{Eclipse Marketplace de Eclipse} \ref{fig:Eclipse_marketplace}, el cual se encuentra en la opción de ``\textbf{\textit{Help/Eclipse Marketplace...}}'' de la barra de herramientas.

\imagenflotante{Eclipse_marketplace}{Eclipse marketplace}{0.7}

Una vez en el Eclipse Marketplace, se buscará ``\textbf{Vaadin}'' y se pulsará ``\textbf{Go}''. Tras salir el plugin ``\textbf{\textit{Vaadin Plugin for Eclipse}}'', se dará a ``\textbf{Install}'' y comenzará la instalación del plugin \ref{fig:Plugin_Vaadin}. En la imagen ya se muestra una vez instalado.

\imagenflotante{Plugin_Vaadin}{Plugin Vaadin}{0.9}

\section{Compilación, instalación y ejecución del proyecto}

Se explicará como compilar, instalar y ejecutar el proyecto. En el caso de
la ejecución, se detallará como hacerlo desde un terminal y mediante Eclipse (IDE).

\subsection{Descarga del repositorio}
El código fuente se encuentra en el \href{https://github.com/drg1006/Gestor-TFG-2022.git}{repositorio del proyecto} en GitHub. Para descargarlo se deberá hacer click en ``\textbf{\textit{Code}}'' y copiar la URL que aparece en el apartado de ``\textbf{HTTP}''. Con esta URL deberemos ir al ``\textbf{GitHub Desktop}'' y clonar el repositorio \ref{fig:GitHub_Code}.

\imagenflotante{GitHub_Code}{Copiar URL repositorio}{0.9}

Si se desea tener código en local se deberá descargar el zip ``\textbf{\textit{Download ZIP}}'' en la opción ``\textbf{\textit{Code}}'' anteriormente mencionada. Una vez descargado el fichero se descomprimirá y abrirá con Eclipse. 

\subsection{Compilación del proyecto}

Para compilar el proyecto en local desde terminal se usará:
\begin{itemize}
	\item Limpiar las dependencias: \texttt{mvn clean}.
	\item Instalar dependencias y compilar: \texttt{mvn install}.
	\item Instalar en modo producción (para desplegar): \texttt{mvn package -Pproduction}.  
	\item Ejecutar test: \texttt{mvn test}.	
\end{itemize}

\subsection{Ejecución del proyecto desde local}

Para la ejecución del proyecto en local desde terminal se usará:
\begin{itemize}
	\item Entrar en la terminal que utilicemos.
	\item Acceder a la carpeta donde tenemos nuestro servidor tomcat instalado y entrar en la carpeta \textbf{/bin}.
	\item Ejecutar nuestro servidor local mediante \textbf{startup} \ref{fig:tomcat_cmd}.  
	\item Entrar en el nuestro navegador en la direccion \textbf{localhost:8080}.
	\item Pulsar en la opción Manage App \ref{fig:Manage_App}.
	\item Iniciamos sesión como manager-gui.(Indicado en el archivo /conf/tomcat-users.xml).
	\item Llegaremos a la pantalla \ref{fig:Desplegar_war} y seleccionaremos el archivo .war que hemos creado al compilar nuestro proyecto con \textbf{``mvn package -Pproduction''}.
	
	\imagenflotante{tomcat_cmd}{Consola con Tomcat ejecutado}{0.9}
	
	\imagenflotante{Manage_App}{Gestor de Aplicaciones de Tomcat}{0.9}
	
	\imagenflotante{Desplegar_war}{Desplegar el archivo .war}{0.9}
	
\end{itemize}

\subsection{Ejecución del proyecto desde Eclipse IDE}

Para la ejecución del proyecto en local desde Eclipse primero debemos importar como proyecto Maven, con el \textbf{pom.xml}. Utilizaremos también un servidor local de de \href{https://tomcat.apache.org/i}{Apache Tomcat}, en concreto, la versión 9. Se puede descargar en \href{https://tomcat.apache.org/download-90.cgi}{la página oficial de Apache Tomcat}.


Una vez descargado y descomprimido, se creará un servicio de Tomcat, ver imagen \ref{fig:añadirTomcat}, con la ruta donde se tiene descargado Tomcat y se le dará un nombre, ver imagen \ref{fig:nombreServerTomcat}. Por último, se añadirá el proyecto principal ``sistinf'', ver imagen \ref{fig:tomcatAñadirProyecto}.

\imagenflotante{añadirTomcat}{Añadir servidor de Tomcat a Eclipse}{0.9}
\imagenflotante{nombreServerTomcat}{Seleccionar carpeta contenedora de Tomcat}{0.9}
\imagenflotante{tomcatAñadirProyecto}{Añadir proyectos a servidor}{0.9}

Para ejecutarlo desde Eclipse debemos también seguir todos los pasos de compilación anteriormente mencionados.

Una vez tengamos compilado nuestro código debemos ejecutarlo (click derecho en el proyecto $\rightarrow$ \texttt{Run As} $\rightarrow$ \texttt{Run on Server}).

Si no aparece la vista de los servicios se puede añadir desde la barra de herramientas$\rightarrow$ \texttt{Window} $\rightarrow$ \texttt{Show View}. Para configurar la ruta donde se ejecuta la aplicación, por defecto en \href{http://localhost:8080/}{localhost:8080/} o en ciertos casos \href{http://localhost:8080/sistinf}{localhost:8080/sistinf}.

\subsection{Problemas a la hora de ejecutar el proyecto}

A la hora de ejecutar el proyecto anterior surgieron una serie de problemas tanto para la ejecución por terminal como desde Eclipse.

Cuando quise ejecutarlo mediante la terminal desplegando el archivo .war generado tras compilar me surgía el siguiente error \ref{fig:Error_war}

\imagenflotante{Error_war}{Error tras deplegar el .war en el Gestor de Aplicaciones de Tomcat}{0.9}

Tras buscar información sobre el posible error, se descubre en los logs que proporciona tomcat lo siguiente \ref{fig:error_size}. En el que se informa que se intenta ejecutar un proyecto con un tamaño mayor al que tenemos configurado en tomcat.

\imagenflotante{error_size}{Logs proporcionados por Tomcat}{0.9}

Para solucionar este problema se accede al archivo \emph{apache-tomcat-9.0.68-webapps-manager-WEB-INF} y se modifican las siguientes lineas \ref{fig:size_tomcat} aumentando el número que se indica.

\imagenflotante{size_tomcat}{Logs proporcionados por Tomcat}{0.9}

Cuando quise ejecutarlo mediante Eclipse no me dejaba añadir el proyecto al servidor de \emph{tomcat}, indicando que las versiones no eran compatibles. Por ello se ha entrado en las propiedades del proyecto y se ha cambiado la versión del parametro \emph{Dynamic Web Module} a la 3.1 en el apartado \emph{Project Facets} como se aprecia en \ref{fig:Dynamic} .

\imagenflotante{Dynamic}{Cambio de versión Dynamic Web Module}{0.9}
 
\subsection{Alternativa a Heroku}

A partir del día 28 de noviembre Heroku dejará de ser gratuito, pero ofrecen una alternativa para estudiantes. Esta opción es un acuerdo entre el \href{https://education.github.com}{programa de estudiantes de GitHub} y Heroku. 
Esta colaboración viene explicada en la plataforma de \href{https://blog.heroku.com/github-student-developer-program}{Heroku}.

Por ello mismo migraremos nuestro proyecto a esa versión de Heroku ya que GitHub estudiantes nos proporciona una serie de créditos mensuales durante un año para desplegar nuestra aplicación.

Los pasos a seguir son los siguientes:
\begin{itemize}
	\item Obtener la verificación GitHub para estudiantes en
	 \href{https://education.github.com/students}{https://education.github.com/students}, ver imagen\ref{fig:GitHub_stu}.
	\item Seguir las instrucciones tras entrar en \emph{Sign up for Global Campus} como se indica en \ref{fig:verify_GH}.
	\item Indicar la escuela/universidad a la que pertenecemos y el uso que le vamos a dar a la cuenta, ver imagen \ref{fig:parametros_GH}.
\end{itemize}

\imagenflotante{GitHub_stu}{Página de acceso a GitHub estudiantes}{0.9}

\imagenflotante{verify_GH}{Proceso de petición de GitHub for students}{0.9}

\imagenflotante{parametros_GH}{Aportar la información necesaria para la verificación}{0.9}

Tras ser verificados por GitHub debemos conectar nuestra cuenta con Heroku desde \href{https://www.heroku.com/github-students}{https://www.heroku.com/github-students}.

Los pasos a seguir son los siguientes:
\begin{itemize}
	\item Conectar nuestra cuenta de Heroku con la cuenta de GitHub para estudiantes.
	\item Debemos añadir una tarjeta bancaria, ya que vamos a utilizar un servicio de pago pero de forma gratuita, por lo que se solicitan esos datos (que se podrán retirar en un futuro sin ningún tipo de pago realizado).
	\item Esperar a que se confirme la solicitud realizada.
	\item Podemos comprobar si hemos sido verificados si tenemos los créditos añadidos en nuestra pestaña de \emph{Account Settings} en \emph{Billing} \ref{fig:Billing}.
\end{itemize}
El resultado final debería ser el siguiente \ref{fig:final_HGH}
\imagenflotante{final_HGH}{Pestaña final tras aplicar a la oferta}{0.9}

\imagenflotante{Billing}{Créditos de nuestra cuenta}{0.9}

Una vez hemos obtenido los créditos modificamos el plan de nuestra aplicación y cambiamos al plan \emph{Basic} con un precio de 7 dólares al mes. Ver imagen \ref{fig:Basic}

\imagenflotante{Basic}{Modificar el plan de despliegue.}{0.9}

\section{Pruebas del sistema}
